<% include ./includes/header.ejs %>
  <!-- Breadcrumbs -->

  <div class="breadcrumbs">
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
          <ul>
            <li class="home"> <a title="Go to Home Page" href="/">홈</a><span>&raquo;</span></li>
            <li class=""> <a title="Go to MyPage" href="Mypage.html">마이페이지</a><span>&raquo;</span></li>
            <li><strong>적립금 관리</strong></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <!-- Breadcrumbs End -->
  <!-- Main Container -->
  <div class="main-container col2-left-layout">
    <div class="container">
      <div class="row">
        <div class="col-main col-sm-9 col-xs-12 col-sm-push-3">

          <div class="shop-inner">
            <div class="page-title">
              <h2 style="float:left;">적립금 관리</h2>
              <a href="#" onclick="Refresh();"><p style="float:right; width:95px; padding:8px; border:1px; border-radius: 50px; font-weight:bold; background-color: #fed700;"> &nbsp;새로고침&nbsp;<i class="fa fa-rotate-left"> </i></p></a>

              <br/><br/>
              <h6 style="float:left;">회원님의 적립금을 관리할 수 있습니다.</h6>

            </div>
            <div class="pagination-area "></div>
            <div class="order-detail-content">

              <h4>적립금 관리</h4>
              <div class="table-responsive">
                <table class="table table-bordered cart_summary">
                  <thead>
                    <tr>
                      <th class="cart_product">면세점</th>
                      <th>설명</th>
                      <th>연동여부</th>
                      <th>총 적립금 금액</th>

                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="cart_product"><img src="images/shilla_logo2.jpg" alt="Product"></td>
                      <td class="cart_description"><p class="product-name" style="text-align:center; font-weight:bold; margin:0 0 0px;">신라인터넷면세점</p>
                      <%
                      if(SL_reserved==false){

                        %>
                        <td class="availability out-of-stock"><span class="label">연동 미완료</span></td>
                        <td class="price"><span>-</span></td>
                        <%
                      }
                      else{
                        %>
                        <td class="availability in-stock"><span id="SL_auth" class="label">연동 완료</span></td>
                        <td class="price"><span id='SL_reserved'>$ <%=SL_reserved%></span></td>

                        <%
                      }
                        %>


                    </tr>
                    <tr>
                      <td class="cart_product"><img src="images/lotte_logo2.jpg" alt="Product"></td>
                      <td class="cart_description"><p class="product-name" style="text-align:center; font-weight:bold; margin:0 0 0px;">롯데인터넷면세점</p>
                        <%
                        if(LT_reserved==false){

                          %>
                          <td class="availability out-of-stock"><span class="label">연동 미완료</span></td>
                          <td class="price"><span>-</span></td>
                          <%
                        }
                        else{
                          %>
                          <td class="availability in-stock"><span id="LT_auth" class="label">연동 완료</span></td>
                          <td class="price"><span id='LT_reserved'>$ <%=LT_reserved%></span></td>

                          <%
                        }
                          %>


                    </tr>
                    <tr>
                      <td class="cart_product"><img src="images/shinsegae_logo2.jpg" alt="Product"></td>
                      <td class="cart_description"><p class="product-name" style="text-align:center; font-weight:bold; margin:0 0 0px;">신세계인터넷면세점</p>
                        <%
                        if(SSG_reserved==false){

                          %>
                          <td class="availability out-of-stock"><span class="label">연동 미완료</span></td>
                          <td class="price"><span>-</span></td>
                          <%
                        }
                        else{
                          %>
                          <td class="availability in-stock"><span id="SSG_auth" class="label">연동 완료</span></td>
                          <td class="price"><span id='SSG_reserved'>$ <%=SSG_reserved%></span></td>

                          <%
                        }
                          %>


                    </tr>
                  </tbody>

                </table>
              </div>
            </div>
            <div class="pagination-area "></div>
          </div>
        </div>
        <aside class="sidebar col-sm-3 col-xs-12 col-sm-pull-9">
          <div class="block shop-by-side">
            <div class="sidebar-bar-title">
              <h3>마이페이지</h3>
            </div>
            <div class="block-content">
              <div class="layered-Category">
                <div class="layered-content">
                  <ul class="check-box-list">
                    <li>
                      <label for="jtv2"> <a href="/user/mypage"><span class="button">내 계정</span> </a> </label>
                    </li>
                    <li>
                      <label for="jtv2"> <a href="/Dutyfree_linkage"><span class="button"> 면세점 연동</span></a> </label>
                    </li>
                    <li>
                      <label for="jtv2"> <a href="/Manage_reserve"><span class="button"> 적립금 관리</span></a> </label>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </div>
  <!-- Main Container End -->
  <!-- Footer -->

  <footer>
    <div class="footer-newsletter">
      <div class="container">
        <div class="row">
          <div class="col-md-8 col-sm-7">
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <div class="col-sm-6 col-md-4 col-xs-12 col-lg-3">
          <div class="footer-logo"><a href="/index"><img src="images/saemyundae.PNG" style="max-width:50%" alt="fotter logo"></a> </div>
          <p style="text-align:center; margin:0 0 0px">세면대는 인터넷 면세점을 이용하거나</p>
          <p style="text-align:center;  margin:0 0 0px">관련 정보를 얻고 싶을 때 도움을 주는</p>
          <p style="text-align:center;  margin:0 0 15px">최고의 인터넷면세점 ‘도우미’입니다.</p>

        </div>
        <div class="col-sm-6 col-md-3 col-xs-12 col-lg-3 collapsed-block">
          <div class="footer-content">
            <div class="email"> <i class="fa fa-envelope"></i>
              <p>smdManager123@gmail.com</p>
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-md-3 col-xs-12 col-lg-3 collapsed-block">
          <div class="footer-content">
            <div class="phone"> <i class="fa fa-phone"></i>
              <p>(02) 712-5233</p>
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-md-3 col-xs-12 col-lg-3 collapsed-block">
          <div class="footer-content">
            <div class="address"> <i class="fa fa-map-marker"></i>
              <p>서울시 노원구 공릉동 232-2 3층</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- <div class="footer-coppyright">
      <div class="container">
        <div class="row">
          <div class="col-sm-6 col-xs-12 coppyright"> Copyright © 2017 <a href="#"> Modern </a>. All Rights Reserved. </div>
          <div class="col-sm-6 col-xs-12">
            <div class="payment">
              <ul>
                <li><a href="#"><img title="Visa" alt="Visa" src="images/visa.png"></a></li>
                <li><a href="#"><img title="Paypal" alt="Paypal" src="images/paypal.png"></a></li>
                <li><a href="#"><img title="Discover" alt="Discover" src="images/discover.png"></a></li>
                <li><a href="#"><img title="Master Card" alt="Master Card" src="images/master-card.png"></a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div> -->
  </footer>
  <a href="#" class="totop"> </a> </div>

<!-- End Footer -->
<!-- JS -->

<!-- jquery js -->
<script type="text/javascript" src="js/jquery.min.js"></script>

<!-- bootstrap js -->
<script type="text/javascript" src="js/bootstrap.min.js"></script>

<!-- owl.carousel.min js -->
<script type="text/javascript" src="js/owl.carousel.min.js"></script>

<!-- bxslider js -->
<script type="text/javascript" src="js/jquery.bxslider.js"></script>

<!--jquery-slider js -->
<script type="text/javascript" src="js/slider.js"></script>

<!-- megamenu js -->
<script type="text/javascript" src="js/megamenu.js"></script>
<script type="text/javascript">
        /* <![CDATA[ */
        var mega_menu = '0';

        /* ]]> */
        </script>

<!-- jquery.mobile-menu js -->
<script type="text/javascript" src="js/mobile-menu.js"></script>



<!--jquery-ui.min js -->
<script type="text/javascript" src="js/jquery-ui.js"></script>

<!-- main js -->
<script type="text/javascript" src="js/main.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<!-- <script src="https://code.jquery.com/jquery-1.12.4.js"></script> -->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="js/notify.js"></script>
<link rel="stylesheet" href="css/notify.css">
<link href="css/jquery.sweet-modal.min.css" rel="stylesheet">
<script src="js/jquery.sweet-modal.min.js"></script>
<script>



$(function(){
  var SL_check = <%=SL_reserved%>;
  var LT_check = <%=LT_reserved%>;
  var SSG_check = <%=SSG_reserved%>;

  var body = {
    'user_id' : <%=user_id%>,
    'SL_check' : SL_check,
    'LT_check' : LT_check,
    'SSG_check' : SSG_check
  }

  $.ajax({
    type: "POST",
    url: "/getreserved",
    async : true,
    data : body,
    dataType : "JSON",
    success: function(json) {

      if(SL_check==true){
        $('#SL_reserved').text("$"+json[0]);
      }
      if(LT_check==true){
        $('#LT_reserved').text("$"+json[1]);
      }
        if(SSG_check==true){
          $('#SSG_reserved').text("$"+json[2]);
        }
        $.notify("면세점에서 고객님의 적립금을 가져왔습니다.", {align:"right", verticalAlign:"top"});

      },
      beforeSend: function() {
        if(SL_check==true){
                  $('#SL_reserved').text("연동중입니다.");
        }
        if(LT_check==true){
            $('#LT_reserved').text("연동중입니다.");
        }
          if(SSG_check==true){
          $('#SSG_reserved').text("연동중입니다.");
          }


      },
      complete: function() {
      },
      error: function(error) {
        console.log(error);
      }
  })


  //
  // if(SL_check){
  //   $.ajax({
  //     type: "POST",
  //     url: "/getSLreserved",
  //     async : true,
  //     data : body,
  //     dataType : "JSON",
  //     success: function(json) {
  //         $('#SL_reserved').text(json[0]+"원");
  //       },
  //       beforeSend: function() {
  //         $('#SL_reserved').text("연동중입니다.");
  //       },
  //       complete: function() {
  //       },
  //       error: function(error) {
  //         console.log(error);
  //       }
  //   })
  // }
  // if(LT_check){
  //   $.ajax({
  //     type: "POST",
  //     url: "/getLTreserved",
  //     async : true,
  //     data : body,
  //     dataType : "JSON",
  //     success: function(json) {
  //         $('#LT_reserved').text(json[0]+"원");
  //       },
  //       beforeSend: function() {
  //         $('#LT_reserved').text("연동중입니다.");
  //       },
  //       complete: function() {
  //       },
  //       error: function(error) {
  //         console.log(error);
  //       }
  //   })
  // }
  // if(SSG_check){
  //   $.ajax({
  //     type: "POST",
  //     url: "/getSSGreserved",
  //     async : true,
  //     data : body,
  //     dataType : "JSON",
  //     success: function(json) {
  //         $('#SSG_reserved').text(json[0]+"원");
  //       },
  //       beforeSend: function() {
  //         $('#SSG_reserved').text("연동중입니다.");
  //       },
  //       complete: function() {
  //       },
  //       error: function(error) {
  //         console.log(error);
  //       }
  //   })
  // }
})

function Refresh(){
  var SL_check = <%=SL_reserved%>;
  var LT_check = <%=LT_reserved%>;
  var SSG_check = <%=SSG_reserved%>;
  var body = {
    'user_id' : <%=user_id%>
  }
  if(SL_check==true||LT_check==true||SSG_check==true){
    $.ajax({
      type: "POST",
      url: "/reserve/refresh",
      async : true,
      data : body,
      dataType : "JSON",
      success: function(json) {
        console.log("refresh");

        if(SL_check==true){
          $('#SL_reserved').text("$"+json.SL_reserved);
        }
        if(LT_check==true){
          $('#LT_reserved').text("$"+json.LT_reserved);
        }
          if(SSG_check==true){
            $('#SSG_reserved').text("$"+json.SSG_reserved);
          }

          $.notify("면세점에서 고객님의 적립금을 가져왔습니다.", {align:"right", verticalAlign:"top"});
        },
        beforeSend: function() {
          if(SL_check==true){
                    $('#SL_reserved').text("연동중입니다.");
          }
          if(LT_check==true){
              $('#LT_reserved').text("연동중입니다.");
          }
            if(SSG_check==true){
            $('#SSG_reserved').text("연동중입니다.");
            }


        },
        complete: function() {
        },
        error: function(error) {
          console.log(error);
        }
    })
  }
  else{
    $.notify("가져올 면세점의 정보가 없습니다.", {align:"right", verticalAlign:"top"});
  }

}
</script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<!-- <script src="https://code.jquery.com/jquery-1.12.4.js"></script> -->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>
 $(document).ready(function() {
    $.ajax({
      type: "POST",
      url: "/autocomplete",
      async: true,
      dataType: "JSON",
      success: function(json) {
        var result = json.slice(0,10);
        $("#searchbox").autocomplete({
          source:  function(request, response) {
                json=json.filter(function(n){ return n != undefined });
                var results = $.ui.autocomplete.filter(json, request.term);
                // console.log(results);
                response(results.slice(0,10));
            },
          select: function(event, ui) {
            console.log(ui.item);
          },
          focus: function(event, ui) {
            $("#searchbox").val(ui.item.label);
            return false;
            //event.preventDefault();
          }
        });
      }
    })
  })
</script>
</body>
</html>
