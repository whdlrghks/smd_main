<% include ./includes/header.ejs %>
  <!-- Breadcrumbs -->
  <!-- calendar CSS -->
  <link rel="stylesheet" type="text/css" href="css/calendar.css">

    <div class="breadcrumbs">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <ul>
              <li class="home"> <a title="Go to Home Page" href="/">홈</a><span>&raquo;</span></li>
              <li><strong> 장바구니</strong></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <!-- Breadcrumbs End -->

    <!-- Main Container -->
    <section class="main-container col1-layout">
      <div class="main container">
        <div class="col-main">
          <div class="cart">
            <div class="page-content page-order">
              <div class="page-title">
                <h2>장바구니</h2>
              </div>
              <div class="order-detail-content">
                <div class="table-responsive">
                  <table class="table table-bordered cart_summary">
                    <thead>
                      <tr>
                        <th>상품</th>
                        <th>설명</th>
                        <th>재고</th>
                        <th>정상가</th>
                        <th>최대 적용 가능 적립금</th>
                        <th>면세점 이동</th>
                        <th>삭제</th>
                      </tr>
                    </thead>
                    <tbody>

                      <%

                      var totalprice=0;
                      var price_list=[];

                      var discount_sl=0;
                      var discount_lt=0;
                      var discount_ssg=0;
                      for(var i = 0 ; i < product_list.length ; i++){
                        var max_discount = ((product_list[i].price*product_list[i].percent)/100).toFixed(2);
                        totalprice=totalprice*1+product_list[i].price*1;
                        var duty_free ;
                        if(product_list[i].duty_category==0){
                          duty_free="신라인터넷면세점"
                          discount_sl=discount_sl+max_discount;
                        }
                        else if(product_list[i].duty_category==1){
                          duty_free="롯데인터넷면세점"
                          discount_lt=discount_lt+max_discount;
                        }
                        else if(product_list[i].duty_category==2){
                          duty_free="신세계인터넷면세점"
                          discount_ssg=discount_ssg+max_discount;
                        }
                       %>
                      <tr>
                        <td class="cart_product"><a href="<%=product_list[i].prd_url%>"><img src="<%=product_list[i].img_url%>" alt="Product"></a></td>

                        <td class="cart_description"><p><a href="#"><%=product_list[i].prd_name%></a></p>

                          <small><%=duty_free%></small><br>
                          <%if(product_list[i].storage){%>
                        <td class="availability in-stock"><span class="label">In stock</span></td>
                        <%}else{%>
                        <td class="availability out-of-stock"><span class="label">No stock</span></td>
                        <%}%>
                        <td class="price"><span style="color:#333248">$<%=product_list[i].price%></span></td>
                        <td class="cart_reserve"><span>$<%=max_discount%></span></td>
                        <td class="move"><a href="<%=product_list[i].prd_url%>" target="_blank">해당 면세점 이동하기</a></td>
                        <td class="action"><a href="#" onclick="delete_cart(this);" id="delete_id" value="<%=product_list[i]._id%>"><i class="icon-close"></i></a></td>
                      </tr>
                      <% }
                      let remain_lt;
                      let remain_sl;
                      let remain_ssg;
                      if(discount_lt>=LT_reserved){
                        remain_lt=LT_reserved;
                      }else{
                        remain_lt=discount_lt;
                      }
                      if(discount_sl>=SL_reserved){
                        remain_sl=SL_reserved;
                      }else{
                        remain_sl=discount_sl;
                      }
                      if(discount_ssg>=SSG_reserved){
                        remain_ssg=SSG_reserved;
                      }else{
                        remain_ssg=discount_ssg;
                      }
                      let total_discount = remain_lt*1+remain_sl*1+remain_ssg*1;
                      %>
                      <tr>
                        <td colspan="7">
                      </tr>
                    </tbody>


                    <tfoot>
                      <tr>
                        <td colspan="1" rowspan="3" style="text-align:center; font:inherit;">보유 적립금</td>
                        <%if(SL_reserved!=null){%>
                        <td style="font-size:13px; font-weight:bold; text-align:center;">신라인터넷면세점 : $<%=SL_reserved%></td>
                        <%}else{%>
                        <td style="font-size:13px; font-weight:bold; text-align:center;">신라인터넷면세점 : -</td>

                        <%}%>
                        <td colspan="3" style="text-align:center;">총 상품 정상가</td>
                        <td colspan="2" style="text-align:right;">$<%=totalprice%> &nbsp;</td>
                      </tr>
                      <tr>
                        <%if(LT_reserved!=null){%>
                        <td style="font-size:13px; font-weight:bold; text-align:center;">롯데인터넷면세점 : $<%=LT_reserved%></td>
                        <%}else{%>
                        <td style="font-size:13px; font-weight:bold; text-align:center;">롯데인터넷면세점 : -</td>

                        <%}%>

                        <td colspan="3" style="text-align:center;"><strong>총 적용 적립금</strong></td>
                        <td colspan="2" style="text-align:right;"><strong>$<%=total_discount%> &nbsp;</strong></td>
                      </tr>
                      <tr>
                        <%if(SSG_reserved!=null){%>
                        <td style="font-size:13px; font-weight:bold; text-align:center;">신세계인터넷면세점 : $<%=SSG_reserved%></td>
                        <%}else{%>
                        <td style="font-size:13px; font-weight:bold; text-align:center;">신세계인터넷면세점 : -</td>

                        <%}%>

                        <td colspan="3" style="text-align:center;"><strong style="color:#0000ff;">총 상품 세면대 최저가</strong></td>
                        <td colspan="2" style="text-align:right;"><strong style="color:#0000ff;">$<%=totalprice
                          *1-total_discount*1%> &nbsp;</strong></td>
                      </tr>
                    </tfoot>


                  </table>
                </div>
                <div class="cart_navigation"> <a class="continue-btn" href="/"><i class="fa fa-arrow-left"> </i>&nbsp; 쇼핑 계속하기</a></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>


   <!-- Footer -->

    <footer>
      <div class="footer-newsletter">
        <div class="container">
          <div class="row">
            <div class="col-md-8 col-sm-7">
            </div>
          </div>
        </div>
      </div>
      <div class="container">
        <div class="row">
          <div class="col-sm-6 col-md-4 col-xs-12 col-lg-3">
            <div class="footer-logo"><a href="/index"><img src="images/saemyundae.PNG" style="max-width:50%" alt="fotter logo"></a> </div>
            <p style="text-align:center; margin:0 0 0px">세면대는 인터넷 면세점을 이용하거나</p>
            <p style="text-align:center;  margin:0 0 0px">관련 정보를 얻고 싶을 때 도움을 주는</p>
            <p style="text-align:center;  margin:0 0 15px">최고의 인터넷면세점 ‘도우미’입니다.</p>

          </div>
          <div class="col-sm-6 col-md-3 col-xs-12 col-lg-3 collapsed-block">
            <div class="footer-content">
              <div class="email"> <i class="fa fa-envelope"></i>
                <p>smdManager123@gmail.com</p>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-md-3 col-xs-12 col-lg-3 collapsed-block">
            <div class="footer-content">
              <div class="phone"> <i class="fa fa-phone"></i>
                <p>(02) 712-5233</p>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-md-3 col-xs-12 col-lg-3 collapsed-block">
            <div class="footer-content">
              <div class="address"> <i class="fa fa-map-marker"></i>
                <p>서울시 노원구 공릉동 232-2 3층</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- <div class="footer-coppyright">
        <div class="container">
          <div class="row">
            <div class="col-sm-6 col-xs-12 coppyright"> Copyright © 2017 <a href="#"> Modern </a>. All Rights Reserved. </div>
            <div class="col-sm-6 col-xs-12">
              <div class="payment">
                <ul>
                  <li><a href="#"><img title="Visa" alt="Visa" src="images/visa.png"></a></li>
                  <li><a href="#"><img title="Paypal" alt="Paypal" src="images/paypal.png"></a></li>
                  <li><a href="#"><img title="Discover" alt="Discover" src="images/discover.png"></a></li>
                  <li><a href="#"><img title="Master Card" alt="Master Card" src="images/master-card.png"></a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div> -->
    </footer>
     <a href="#" class="totop"> </a>
   </div>

   <!-- End Footer -->

   <!-- JS -->

   <!-- jquery js -->
   <script type="text/javascript" src="js/jquery.min.js"></script>

   <!-- bootstrap js -->
   <script type="text/javascript" src="js/bootstrap.min.js"></script>

   <!-- owl.carousel.min js -->
   <script type="text/javascript" src="js/owl.carousel.min.js"></script>

   <!-- bxslider js -->
   <script type="text/javascript" src="js/jquery.bxslider.js"></script>

   <!-- flexslider js -->
   <script type="text/javascript" src="js/jquery.flexslider.js"></script>

   <script type="text/javascript" src="./js/jquery.oLoader.min.js"></script>

   <!-- megamenu js -->
   <script type="text/javascript" src="js/megamenu.js"></script>
   <script type="text/javascript">
     /* <![CDATA[ */
     var mega_menu = '0';

     /* ]]> */
     </script>

   <!-- jquery.mobile-menu js -->
   <script type="text/javascript" src="js/mobile-menu.js"></script>

   <!--jquery-ui.min js -->
   <script type="text/javascript" src="js/jquery-ui.js"></script>

   <!-- main js -->
   <script type="text/javascript" src="js/main.js"></script>

   <!-- countdown js -->
   <script type="text/javascript" src="js/countdown.js"></script>

   <!--cloud-zoom js -->
   <script type="text/javascript" src="js/cloud-zoom.js"></script>

   <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
   <!-- <script src="https://code.jquery.com/jquery-1.12.4.js"></script> -->
   <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
   <script src="js/jquery.growl.js" type="text/javascript"></script>
   <link href="css/jquery.growl.css" rel="stylesheet" type="text/css" />
   <link href="css/jquery.sweet-modal.min.css" rel="stylesheet">
   <script src="js/jquery.sweet-modal.min.js"></script>
   <script>
    $(document).ready(function() {});

   function delete_cart(obj){
     var prd_id = $('#delete_id').attr('value');
     var delete_info={
       _id : prd_id
     }
     // console.log($('#delete_id').attr('value'));
     $.ajax({
       type: "POST",
       url: "/product/deleteCart",
       data: delete_info,
       async: false,
       dataType: "JSON",
       success: function(json) {
         //성공시 success

         if(json=='success'){
           $.notify("해당 상품을 장바구니에서 삭제하였습니다.", { verticalAlign:"top", type:"success"});
           location.reload();
         }
         else{
           $.notify("해당 상품을 장바구니에서 삭제하는데 실패하였습니다.", { verticalAlign:"top", type:"danger"});
           location.reload();
         }
       }
     })

   }

   </script>

   </body>
   </html>
